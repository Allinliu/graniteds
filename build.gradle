buildscript {
    repositories {
        mavenCentral()
    }

    dependencies {
        classpath 'nl.javadude.gradle.plugins:license-gradle-plugin:0.5.0'
    }
}

apply plugin: 'java'
apply plugin: 'maven'
apply plugin: 'signing'
apply plugin: 'eclipse'
apply plugin: 'license'
	
group = 'org.graniteds'
version = granitedsVersion
	
repositories {
	mavenLocal()
	mavenCentral()
}

sourceCompatibility = 1.6

configurations {
	deployerJars
	create('sources')
}

task sourcesJar(type: Jar, dependsOn: 'classes') {
	classifier = 'sources'
	from sourceSets.main.allSource
}
	
task javadocJar(type: Jar, dependsOn: 'javadoc') {
	classifier = 'javadoc'
	from javadoc.destinationDir
}

dependencies {
	
	compile 'javax.enterprise:cdi-api:1.0-SP4',
		'javax.inject:javax.inject:1',
		'javax.validation:validation-api:1.0.0.GA',
		'org.springframework:spring-beans:3.1.4.RELEASE',
		'org.springframework:spring-context:3.1.4.RELEASE',
		'com.google.android:android:4.0.1.2'
		
	compile files('libs/android-async-http-1.4.3.jar')
	
	compile 'org.graniteds:granite-client:' + granitedsVersion,
		'org.graniteds:granite-client-tide:' + granitedsVersion
	
	deployerJars 'org.apache.maven.wagon:wagon-http:2.2'		
	
	sources group: 'org.graniteds', name: 'granite-client-tide', version: granitedsVersion, classifier: 'sources'
}
	
artifacts {
	archives sourcesJar
	archives javadocJar
}

jar {
	baseName 'granite-client-android'
	
	metaInf {
		from 'LICENSE.txt'
	}
	
	def graniteClientJar = (configurations['compile'].files { it.name == 'granite-client-tide' }).iterator().next()
	from zipTree(graniteClientJar)
}
sourcesJar {
	baseName 'granite-client-android'
	
	def graniteClientSourceJar = (configurations['sources'].files { it.name == 'granite-client-tide' }).iterator().next()
	from zipTree(graniteClientSourceJar)
}
javadocJar {
	baseName 'granite-client-android'
}

javadoc {
	title 'GraniteDS Android client Documentation'
	
	def graniteClientSourceJar = (configurations['sources'].files { it.name == 'granite-client-tide' }).iterator().next()
	source(files(zipTree(graniteClientSourceJar).matching { include '**/*.java' }))
	
	configure(options) {
		version = true
		author = true
		use = true
		linkSource = true
		// stylesheetFile = new File(projectDir, 'jdstyle.css')
		windowTitle = 'GraniteDS Android client API Documentation'
		docTitle = 'GraniteDS Android client API Documentation - ' + granitedsVersion
		links = [
			"http://download.oracle.com/javase/1.5.0/docs/api/",
			"http://download.oracle.com/javaee/6/api/",
			"http://java.sun.com/products/servlet/2.3/javadoc/",
			"http://logging.apache.org/log4j/1.2/apidocs/",
			"http://tomcat.apache.org/tomcat-6.0-doc/api/",
			"http://docs.jboss.org/hibernate/orm/3.5/javadocs/",
			"http://docs.jboss.com/seam/2.2.0.GA/api/",
			"http://static.springsource.org/spring/docs/3.0.x/api/",
			"http://jetty.codehaus.org/jetty/jetty-6/apidocs/"
		]
	}
}

signing {
	required { gradle.taskGraph.hasTask("uploadArchives") }
	sign configurations.archives
}

license {
	header rootProject.file('HEADER.txt')
	strictCheck true
	ext.year = Calendar.getInstance().get(Calendar.YEAR)
}

eclipse {
	project {
		name = 'graniteds-java-client-android'
	}
}

uploadArchives {
	repositories {
		mavenDeployer {
			beforeDeployment { 
				MavenDeployment deployment -> signing.signPom(deployment)
			}
			
			repository(url: "https://oss.sonatype.org/service/local/staging/deploy/maven2/") {
				authentication(userName: sonatypeOssUserName, password: sonatypeOssPassword)
			}
				
			pom.project {
				name 'GraniteDS JavaFX client'
				packaging 'jar'
				description 'GraniteDS JavaFX client'
				url 'http://www.graniteds.org'
				
				scm {
					url 'scm:git@github.com:graniteds/graniteds-client-javafx.git'
					connection 'scm:git@github.com:graniteds/graniteds-client-javafx.git'
					developerConnection 'scm:git@github.com:graniteds/graniteds-client-javafx.git'
				}
				
				licenses {
					license {
						name 'GNU General Public License, Version 3, 29 June 2007'
						url 'http://www.gnu.org/licenses/gpl-3.0.en.html'
						distribution 'repo'
					}
				}
	  
				developers {
					developer {
						id 'fwolff'
						name 'Franck Wolff'
					}
					developer {
						id 'wdrai'
						name 'William Drai'
					}
				}
			}
			
			pom.whenConfigured { pom ->
				pom.dependencies.remove (
					pom.dependencies.find { dep -> dep.groupId == 'org.graniteds' && dep.artifactId == 'granite-client-tide' }
				)
			}
		}
	}

}

